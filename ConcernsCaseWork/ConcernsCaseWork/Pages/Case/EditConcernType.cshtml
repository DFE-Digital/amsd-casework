@page "/case/{id:long}/management/editconcerntype"
@model ConcernsCaseWork.Pages.Case.EditConcernTypePageModel

<h1 class="govuk-heading-l">
	Change concern
</h1>

<div tabindex="-1" role="group" id="errorSummary" class="govuk-error-summary moj-hidden" aria-labelledby="error-summary-title" data-module="error-summary"></div>

<form role="form" asp-page-handler="editConcernType" method="post" id="concern-type-form" novalidate>

	<div class="govuk-form-group">
		<fieldset class="govuk-fieldset">
			<partial name="_ConcernType" model="Model.TypesDictionary"></partial>
		</fieldset>
	</div>

	<!--Button group-->
	<div class="govuk-button-group">
		<button data-prevent-double-click="true" class="govuk-button govuk-!-margin-top-6" data-module="govuk-button">
			Apply
		</button>
		<partial name="_Cancel"></partial>
	</div>
</form>

<script type="application/javascript">
	$(function () {
		let concernTypeForm = $("#concern-type-form");		
		const validator = new MOJFrontend.FormValidator(concernTypeForm[0]);
		validator.addValidator('type', [{
			method: function(field) {
				return field.value.trim().length > 0;
			},
			message: 'Select concern type'
		}, {
			method: function() {
				let typeChecked = $('input[name="type"]:checked');				
				if (typeChecked !== undefined) {
					let typeAriaControl = typeChecked.attr('aria-controls');
					if (typeAriaControl !== undefined) {
						let concernAriaControlElem = $("#" + typeAriaControl + "");
						let subTypeChildren = concernAriaControlElem.find("input[name='subType']");
						if (subTypeChildren.length > 0) {
							let subTypeChecked = concernAriaControlElem.find("input[name='subType']:checked");
							if (subTypeChecked.length === 0) {
								return false;	
							}
						}
					}
				}
				
				return true;
			},
			message: 'Select concern sub type'
		}]);
	});
</script>

